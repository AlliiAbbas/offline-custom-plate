import{_ as B,u as J,r as g,b as q,c as u,o as i,e as P,a as e,F as N,z as C,d as K,f as U,t as c,n as G,a7 as Q,a4 as M,w as W,i as L}from"./main.Du-5drNh.js";const X={key:0,class:"sync-loader-overlay"},Y={key:1,class:"sync-success-overlay"},Z={__name:"SyncLoader",setup(x,{expose:d}){const n=J(),t=g(!1),a=g(!1),p=g(navigator.onLine);return d({syncData:async h=>{if(h){t.value=!0,a.value=!1;try{await n.dispatch("Vehicle/syncOfflineData").then(()=>{t.value=!1,a.value=!0,setTimeout(()=>{a.value=!1},1e3)})}catch(y){console.error("Failed to sync data:",y),t.value=!1}}}}),q(()=>{window.addEventListener("online",()=>{p.value=!0}),window.addEventListener("offline",()=>{p.value=!1})}),(h,y)=>(i(),u(N,null,[t.value?(i(),u("div",X,y[0]||(y[0]=[e("div",{class:"sync-loader-content"},[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")]),e("p",{class:"mt-3"},"جاري مزامنة البيانات...")],-1)]))):P("",!0),a.value?(i(),u("div",Y,y[1]||(y[1]=[e("div",{class:"success-icon"},[e("i",{class:"fas fa-check-circle"})],-1),e("div",{class:"alert alert-success",role:"alert"}," تم مزامنة البيانات بنجاح ",-1)]))):P("",!0)],64))}},ee=B(Z,[["__scopeId","data-v-02ae9c35"]]),te={class:"table-container",dir:"rtl"},se={class:"table w-100 table-bordered table-hover bg-white shadow-sm rounded"},ae={class:"py-3"},oe={class:"py-3"},ne={class:"py-3"},le={class:"py-3"},ce={class:"py-3"},re={class:"py-3"},ie={class:"py-3"},de={class:"py-3"},ue={class:"py-3"},be={class:"py-3"},ge={class:"py-3"},pe={class:"py-3"},ve={class:"py-3"},ye={class:"py-3"},he={class:"py-3"},_e={class:"py-3"},me={class:"py-3"},fe={class:"py-3"},ke=["onClick"],xe={key:0},$e={key:0,class:"confirmation-dialog"},Ce={__name:"ReportsTable",setup(x,{expose:d}){const n=g([]),t=g(1),a=g(10);let p=0;const f=g(!1),h=g(null),y=o=>!o||o==="done"?"badge bg-success":o==="cancel"?"badge bg-danger":"badge bg-secondary",v=o=>{h.value=o,f.value=!0},b=()=>{f.value=!1,h.value=null},T=async()=>{h.value!==null&&(await z(h.value),b())},z=async o=>{try{const r=(await j()).transaction(["calculations"],"readwrite").objectStore("calculations"),m=n.value[o];console.log("Current item id:",m.id);const E=r.getAll();E.onsuccess=O=>{const D=O.target.result;console.log("Current item id:",m),console.log("All items in DB:",D.map(w=>({id:w.id})));const k=D.find(w=>w.data.id===m.id);if(k){console.log("Found matching item:",k),k.data.status="cancel";const w=r.put(k);w.onsuccess=()=>{console.log("Successfully updated status to cancel"),n.value[o].status="cancel"}}else console.log("No matching item found - Check if id exists")}}catch(l){console.error("Error in handleCancel:",l)}},j=()=>new Promise((o,l)=>{const s=indexedDB.open("customsPlateDB",1);s.onerror=r=>l(r),s.onsuccess=r=>o(r.target.result),s.onupgradeneeded=r=>{const m=r.target.result;m.objectStoreNames.contains("calculations")||m.createObjectStore("calculations",{keyPath:"id",autoIncrement:!0})}}),S=async()=>{try{const o=await _(),l=o.length;l!==p&&(n.value=o.filter(s=>Object.keys(s).length>0),p=l)}catch(o){console.error("خطأ في التحقق من التغييرات",o)}},$=()=>{setInterval(S,1e3)},_=()=>new Promise((o,l)=>{const s=indexedDB.open("customsPlateDB",1);s.onerror=r=>{console.error("خطأ في فتح قاعدة البيانات",r),l(r)},s.onsuccess=r=>{const D=r.target.result.transaction(["calculations"],"readonly").objectStore("calculations").getAll();D.onsuccess=k=>{const V=k.target.result.map(A=>A.owner_name?A:A.data?A.data:{});o(V)},D.onerror=k=>{console.error("خطأ في قراءة البيانات",k),l(k)}},s.onupgradeneeded=r=>{const m=r.target.result;m.objectStoreNames.contains("calculations")||m.createObjectStore("calculations",{keyPath:"id",autoIncrement:!0})}}),I=C(()=>Math.ceil(n.value.length/a.value)),F=C(()=>{const o=(t.value-1)*a.value,l=o+a.value;return n.value.slice(o,l)}),H=o=>{t.value=o};return q(async()=>{try{const o=await _();n.value=o.filter(l=>Object.keys(l).length>0),p=o.length,$()}catch(o){console.error("خطأ في جلب البيانات من IndexedDB",o),n.value=[]}}),K(()=>{clearInterval($)}),d({currentPage:t,totalPages:I,pageSize:a,updatePage:H,totalItems:C(()=>n.value.length)}),(o,l)=>(i(),u("section",te,[e("table",se,[l[2]||(l[2]=e("thead",null,[e("tr",{class:"align-middle text-center"},[e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"اسم المالك"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الرقم القومي"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"العنوان"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الوظيفه"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الطراز"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"سنه الصنع"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"رقم اللوحه"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"رقم الشاسيه"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"رقم الموتور"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"السلندرات"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"نوع الوقود"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"اخر شركه تامين"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"من تاريخ"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الى تاريخ"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"صافي القسط"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الاجمالي"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الحالة"),e("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الإجراءات")])],-1)),e("tbody",null,[(i(!0),u(N,null,U(F.value,(s,r)=>(i(),u("tr",{key:r,class:"align-middle hover-row"},[e("td",ae,c(s.owner_name),1),e("td",oe,c(s.owner_national_id),1),e("td",ne,c(s.owner_address),1),e("td",le,c(s.owner_job),1),e("td",ce,c(s.model),1),e("td",re,c(s.year),1),e("td",ie,c(s.plate),1),e("td",de,c(s.chassis_id),1),e("td",ue,c(s.motor_id),1),e("td",be,c(s.cylinders),1),e("td",ge,c(s.fuel_type_id),1),e("td",pe,c(s.insurance_last_vendor),1),e("td",ve,c(s.from_date),1),e("td",ye,c(s.to_date),1),e("td",he,c(s.net_premium),1),e("td",_e,c(s.total_sum),1),e("td",me,[e("span",{class:G(y(s.status))},c(s.status==="cancel"?" مُلْغى":"نشط"),3)]),e("td",fe,[!s.status||s.status==="done"?(i(),u("button",{key:0,onClick:m=>v(r),class:"btn btn-danger btn-sm"},l[0]||(l[0]=[e("i",{class:"bi bi-x-circle me-1"},null,-1),Q(" إلغاء ")]),8,ke)):P("",!0)])]))),128)),n.value.length===0?(i(),u("tr",xe,l[1]||(l[1]=[e("td",{colspan:"18",class:"text-center"},[e("div",{class:"empty-state"},[e("i",{class:"bi bi-inbox text-muted",style:{"font-size":"2rem"}}),e("p",{class:"text-muted mt-3 mb-0"},"لا توجد بيانات")])],-1)]))):P("",!0)])]),f.value?(i(),u("div",$e,[e("div",{class:"confirmation-content"},[l[3]||(l[3]=e("h4",null,"تأكيد الإلغاء",-1)),l[4]||(l[4]=e("p",null,"هل أنت متأكد من إلغاء هذا العنصر؟",-1)),e("div",{class:"confirmation-actions"},[e("button",{onClick:T,class:"btn btn-danger"},"تأكيد"),e("button",{onClick:b,class:"btn btn-secondary"},"إلغاء")])])])):P("",!0)]))}},Pe=B(Ce,[["__scopeId","data-v-3fd7bad9"]]),Se={name:"PageButton",props:{page:{type:Number,required:!0},isActive:{type:Boolean,default:!1}},emits:["click"]};function Ie(x,d,n,t,a,p){return i(),u("button",{class:G(["btn btn-outline-secondary px-3 py-1 mx-1 btn-sm",{active:n.isActive}]),onClick:d[0]||(d[0]=f=>x.$emit("click"))},c(n.page),3)}const R=B(Se,[["render",Ie]]),we={class:"container",dir:"rtl"},De={class:"row align-items-center"},Be={class:"col-md-auto d-flex flex-wrap align-items-center gap-2"},Te=["disabled"],Ae=["disabled"],Le={class:"pagination mb-0"},Ne={key:0,class:"page-item disabled"},ze=["disabled"],je=["disabled"],qe={class:"col-md-auto ms-auto"},Fe={class:"text-muted"},Ee={__name:"TablePagination",props:{totalItems:{type:Number,required:!0},pageSize:{type:Number,required:!0}},emits:["page-changed"],setup(x,{emit:d}){const n=x,t=g(1),a=C(()=>Math.ceil(n.totalItems/n.pageSize)),p=C(()=>(t.value-1)*n.pageSize+1),f=C(()=>Math.min(t.value*n.pageSize,n.totalItems)),h=C(()=>a.value<=7?Array.from({length:a.value},($,_)=>_+1):t.value<=4?[1,2,3,4,5,6]:t.value>=a.value-3?Array.from({length:6},($,_)=>a.value-5+_):[t.value-2,t.value-1,t.value,t.value+1,t.value+2]),y=C(()=>a.value>7);function v($){t.value=$,S("page-changed",$)}function b(){t.value!==1&&(t.value=1,S("page-changed",1))}function T(){t.value!==a.value&&(t.value=a.value,S("page-changed",a.value))}function z(){t.value<a.value&&(t.value++,S("page-changed",t.value))}function j(){t.value>1&&(t.value--,S("page-changed",t.value))}const S=d;return($,_)=>(i(),u("footer",we,[e("div",De,[e("div",Be,[e("button",{onClick:b,class:"btn btn-outline-secondary btn-sm","aria-label":"First",disabled:t.value===1}," « ",8,Te),e("button",{onClick:j,class:"btn btn-outline-secondary btn-sm","aria-label":"Previous",disabled:t.value===1}," ‹ ",8,Ae),e("div",Le,[(i(!0),u(N,null,U(h.value,I=>(i(),M(R,{key:`page-${I}`,page:I,isActive:t.value===I,onClick:F=>v(I)},null,8,["page","isActive","onClick"]))),128)),y.value?(i(),u("span",Ne,_[1]||(_[1]=[e("span",{class:"page-link"},"...",-1)]))):P("",!0),a.value>7?(i(),M(R,{key:1,page:a.value,isActive:t.value===a.value,onClick:_[0]||(_[0]=I=>v(a.value))},null,8,["page","isActive"])):P("",!0)]),e("button",{onClick:z,class:"btn btn-outline-secondary btn-sm","aria-label":"Next",disabled:t.value===a.value}," › ",8,ze),e("button",{onClick:T,class:"btn btn-outline-secondary btn-sm","aria-label":"Last",disabled:t.value===a.value}," » ",8,je)]),e("div",qe,[e("small",Fe," اظهار "+c(p.value)+" الي "+c(f.value)+" من "+c(x.totalItems)+" مدخل ",1)])])]))}},Oe=B(Ee,[["__scopeId","data-v-b2b4f342"]]),Ve={class:"table-view-container"},Me={class:"table-wrapper"},Re={class:"pagination-wrapper"},Ue={key:0,class:"offline-popup-overlay"},Ge={class:"offline-popup"},He={class:"offline-popup-content"},Je={__name:"TableView",setup(x){const d=g(null),n=g(null),t=g(0),a=g(10),p=g(!1),f=()=>{n.value&&n.value.syncData(!0)},h=v=>{d.value&&d.value.updatePage(v)},y=()=>{if(!navigator.onLine){p.value=!0;return}f()};return W(()=>{var v;return(v=d.value)==null?void 0:v.totalItems},v=>{v!==void 0&&(t.value=v)},{immediate:!0}),q(()=>{d.value&&(t.value=d.value.totalItems)}),(v,b)=>(i(),u(N,null,[e("div",Ve,[b[1]||(b[1]=e("div",{class:"table-header"},[e("h2",{class:"table-title text-end w-100"},"جدول تأمين السيارات")],-1)),e("div",Me,[e("button",{onClick:y,color:"danger",class:"px-4 m-2 rounded-2 bg-danger border-0 text-white"}," مزامنة البيانات "),L(Pe,{ref_key:"reportsTable",ref:d},null,512)]),e("div",Re,[L(Oe,{"total-items":t.value,"page-size":a.value,onPageChanged:h},null,8,["total-items","page-size"])]),L(ee,{ref_key:"loaderSync",ref:n},null,512)]),p.value?(i(),u("div",Ue,[e("div",Ge,[e("div",He,[b[2]||(b[2]=e("div",{class:"offline-popup-icon"},[e("i",{class:"fas fa-wifi-slash"})],-1)),b[3]||(b[3]=e("h3",null,"تنبيه",-1)),b[4]||(b[4]=e("p",null,"المزامنة تكون في وضع الاتصال فقط",-1)),e("button",{onClick:b[0]||(b[0]=T=>p.value=!1),class:"offline-popup-button"},"حسناً")])])])):P("",!0)],64))}},Ke=B(Je,[["__scopeId","data-v-691eb445"]]),Qe={class:"bg-black"},We={class:"bg-black"},Ye={__name:"TablePage",setup(x){return(d,n)=>(i(),u("section",Qe,[e("div",We,[L(Ke,{class:""})])]))}};export{Ye as default};
