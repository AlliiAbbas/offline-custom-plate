import{_ as A,r as _,z as v,b as E,d as J,c as b,o as u,a as t,f as I,F as O,g as U,t as c,n as G,a7 as K,a4 as R,w as Q,e as T}from"./main.CkXzB3fb.js";import{S as W}from"./SyncLoader.DC1_hYBG.js";const X={class:"table-container",dir:"rtl"},Y={class:"table w-100 table-bordered table-hover bg-white shadow-sm rounded"},Z={class:"py-3"},tt={class:"py-3"},et={class:"py-3"},st={class:"py-3"},at={class:"py-3"},ot={class:"py-3"},nt={class:"py-3"},lt={class:"py-3"},ct={class:"py-3"},rt={class:"py-3"},it={class:"py-3"},dt={class:"py-3"},ut={class:"py-3"},bt={class:"py-3"},gt={class:"py-3"},ht={class:"py-3"},mt={class:"py-3"},pt={class:"py-3"},_t=["onClick"],yt={key:0},vt={key:0,class:"confirmation-dialog"},ft={__name:"ReportsTable",setup(f,{expose:d}){const n=_([]),e=_(1),l=_(10);let i=0;const m=_(!1),C=_(null),N=a=>!a||a==="done"?"badge bg-success":a==="cancel"?"badge bg-danger":"badge bg-secondary",S=a=>{C.value=a,m.value=!0},B=()=>{m.value=!1,C.value=null},w=async()=>{C.value!==null&&(await z(C.value),B())},z=async a=>{try{const r=(await j()).transaction(["calculations"],"readwrite").objectStore("calculations"),h=n.value[a];console.log("Current item id:",h.id);const F=r.getAll();F.onsuccess=L=>{const $=L.target.result;console.log("Current item id:",h),console.log("All items in DB:",$.map(P=>({id:P.id})));const p=$.find(P=>P.data.id===h.id);if(p){console.log("Found matching item:",p),p.data.status="cancel";const P=r.put(p);P.onsuccess=()=>{console.log("Successfully updated status to cancel"),n.value[a].status="cancel"}}else console.log("No matching item found - Check if id exists")}}catch(o){console.error("Error in handleCancel:",o)}},j=()=>new Promise((a,o)=>{const s=indexedDB.open("customsPlateDB",1);s.onerror=r=>o(r),s.onsuccess=r=>a(r.target.result),s.onupgradeneeded=r=>{const h=r.target.result;h.objectStoreNames.contains("calculations")||h.createObjectStore("calculations",{keyPath:"id",autoIncrement:!0})}}),k=async()=>{try{const a=await g(),o=a.length;o!==i&&(n.value=a.filter(s=>Object.keys(s).length>0),i=o)}catch(a){console.error("خطأ في التحقق من التغييرات",a)}},y=()=>{setInterval(k,1e3)},g=()=>new Promise((a,o)=>{const s=indexedDB.open("customsPlateDB",1);s.onerror=r=>{console.error("خطأ في فتح قاعدة البيانات",r),o(r)},s.onsuccess=r=>{const $=r.target.result.transaction(["calculations"],"readonly").objectStore("calculations").getAll();$.onsuccess=p=>{const M=p.target.result.map(D=>D.owner_name?D:D.data?D.data:{});a(M)},$.onerror=p=>{console.error("خطأ في قراءة البيانات",p),o(p)}},s.onupgradeneeded=r=>{const h=r.target.result;h.objectStoreNames.contains("calculations")||h.createObjectStore("calculations",{keyPath:"id",autoIncrement:!0})}}),x=v(()=>Math.ceil(n.value.length/l.value)),q=v(()=>{const a=(e.value-1)*l.value,o=a+l.value;return n.value.slice(a,o)}),H=a=>{e.value=a};return E(async()=>{try{const a=await g();n.value=a.filter(o=>Object.keys(o).length>0),i=a.length,y()}catch(a){console.error("خطأ في جلب البيانات من IndexedDB",a),n.value=[]}}),J(()=>{clearInterval(y)}),d({currentPage:e,totalPages:x,pageSize:l,updatePage:H,totalItems:v(()=>n.value.length)}),(a,o)=>(u(),b("section",X,[t("table",Y,[o[2]||(o[2]=t("thead",null,[t("tr",{class:"align-middle text-center"},[t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"اسم المالك"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الرقم القومي"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"العنوان"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الوظيفه"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الطراز"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"سنه الصنع"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"رقم اللوحه"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"رقم الشاسيه"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"رقم الموتور"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"السلندرات"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"نوع الوقود"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"اخر شركه تامين"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"من تاريخ"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الى تاريخ"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"صافي القسط"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الاجمالي"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الحالة"),t("th",{class:"bg-light text-secondary py-3 border-bottom-0 sticky-header"},"الإجراءات")])],-1)),t("tbody",null,[(u(!0),b(O,null,U(q.value,(s,r)=>(u(),b("tr",{key:r,class:"align-middle hover-row"},[t("td",Z,c(s.owner_name),1),t("td",tt,c(s.owner_national_id),1),t("td",et,c(s.owner_address),1),t("td",st,c(s.owner_job),1),t("td",at,c(s.model),1),t("td",ot,c(s.year),1),t("td",nt,c(s.plate),1),t("td",lt,c(s.chassis_id),1),t("td",ct,c(s.motor_id),1),t("td",rt,c(s.cylinders),1),t("td",it,c(s.fuel_type_id),1),t("td",dt,c(s.insurance_last_vendor),1),t("td",ut,c(s.from_date),1),t("td",bt,c(s.to_date),1),t("td",gt,c(s.net_premium),1),t("td",ht,c(s.total_sum),1),t("td",mt,[t("span",{class:G(N(s.status))},c(s.status||"نشط"),3)]),t("td",pt,[!s.status||s.status==="done"?(u(),b("button",{key:0,onClick:h=>S(r),class:"btn btn-danger btn-sm"},o[0]||(o[0]=[t("i",{class:"bi bi-x-circle me-1"},null,-1),K(" إلغاء ")]),8,_t)):I("",!0)])]))),128)),n.value.length===0?(u(),b("tr",yt,o[1]||(o[1]=[t("td",{colspan:"18",class:"text-center"},[t("div",{class:"empty-state"},[t("i",{class:"bi bi-inbox text-muted",style:{"font-size":"2rem"}}),t("p",{class:"text-muted mt-3 mb-0"},"لا توجد بيانات")])],-1)]))):I("",!0)])]),m.value?(u(),b("div",vt,[t("div",{class:"confirmation-content"},[o[3]||(o[3]=t("h4",null,"تأكيد الإلغاء",-1)),o[4]||(o[4]=t("p",null,"هل أنت متأكد من إلغاء هذا العنصر؟",-1)),t("div",{class:"confirmation-actions"},[t("button",{onClick:w,class:"btn btn-danger"},"تأكيد"),t("button",{onClick:B,class:"btn btn-secondary"},"إلغاء")])])])):I("",!0)]))}},kt=A(ft,[["__scopeId","data-v-9d062238"]]),xt={name:"PageButton",props:{page:{type:Number,required:!0},isActive:{type:Boolean,default:!1}},emits:["click"]};function Ct(f,d,n,e,l,i){return u(),b("button",{class:G(["btn btn-outline-secondary px-3 py-1 mx-1 btn-sm",{active:n.isActive}]),onClick:d[0]||(d[0]=m=>f.$emit("click"))},c(n.page),3)}const V=A(xt,[["render",Ct]]),Pt={class:"container",dir:"rtl"},$t={class:"row align-items-center"},It={class:"col-md-auto d-flex flex-wrap align-items-center gap-2"},St=["disabled"],Bt=["disabled"],Dt={class:"pagination mb-0"},Tt={key:0,class:"page-item disabled"},At=["disabled"],Nt=["disabled"],wt={class:"col-md-auto ms-auto"},zt={class:"text-muted"},jt={__name:"TablePagination",props:{totalItems:{type:Number,required:!0},pageSize:{type:Number,required:!0}},emits:["page-changed"],setup(f,{emit:d}){const n=f,e=_(1),l=v(()=>Math.ceil(n.totalItems/n.pageSize)),i=v(()=>(e.value-1)*n.pageSize+1),m=v(()=>Math.min(e.value*n.pageSize,n.totalItems)),C=v(()=>l.value<=7?Array.from({length:l.value},(y,g)=>g+1):e.value<=4?[1,2,3,4,5,6]:e.value>=l.value-3?Array.from({length:6},(y,g)=>l.value-5+g):[e.value-2,e.value-1,e.value,e.value+1,e.value+2]),N=v(()=>l.value>7);function S(y){e.value=y,k("page-changed",y)}function B(){e.value!==1&&(e.value=1,k("page-changed",1))}function w(){e.value!==l.value&&(e.value=l.value,k("page-changed",l.value))}function z(){e.value<l.value&&(e.value++,k("page-changed",e.value))}function j(){e.value>1&&(e.value--,k("page-changed",e.value))}const k=d;return(y,g)=>(u(),b("footer",Pt,[t("div",$t,[t("div",It,[t("button",{onClick:B,class:"btn btn-outline-secondary btn-sm","aria-label":"First",disabled:e.value===1}," « ",8,St),t("button",{onClick:j,class:"btn btn-outline-secondary btn-sm","aria-label":"Previous",disabled:e.value===1}," ‹ ",8,Bt),t("div",Dt,[(u(!0),b(O,null,U(C.value,x=>(u(),R(V,{key:`page-${x}`,page:x,isActive:e.value===x,onClick:q=>S(x)},null,8,["page","isActive","onClick"]))),128)),N.value?(u(),b("span",Tt,g[1]||(g[1]=[t("span",{class:"page-link"},"...",-1)]))):I("",!0),l.value>7?(u(),R(V,{key:1,page:l.value,isActive:e.value===l.value,onClick:g[0]||(g[0]=x=>S(l.value))},null,8,["page","isActive"])):I("",!0)]),t("button",{onClick:z,class:"btn btn-outline-secondary btn-sm","aria-label":"Next",disabled:e.value===l.value}," › ",8,At),t("button",{onClick:w,class:"btn btn-outline-secondary btn-sm","aria-label":"Last",disabled:e.value===l.value}," » ",8,Nt)]),t("div",wt,[t("small",zt," اظهار "+c(i.value)+" الي "+c(m.value)+" من "+c(f.totalItems)+" مدخل ",1)])])]))}},qt=A(jt,[["__scopeId","data-v-10a49d15"]]),Ft={class:"table-view-container"},Lt={class:"table-wrapper"},Mt={class:"pagination-wrapper"},Rt={__name:"TableView",setup(f){const d=_(null),n=_(0),e=_(10),l=i=>{d.value&&d.value.updatePage(i)};return Q(()=>{var i;return(i=d.value)==null?void 0:i.totalItems},i=>{i!==void 0&&(n.value=i)},{immediate:!0}),E(()=>{d.value&&(n.value=d.value.totalItems)}),(i,m)=>(u(),b("div",Ft,[m[0]||(m[0]=t("div",{class:"table-header"},[t("h2",{class:"table-title text-end w-100"},"جدول تأمين السيارات")],-1)),t("div",Lt,[T(kt,{ref_key:"reportsTable",ref:d},null,512)]),t("div",Mt,[T(qt,{"total-items":n.value,"page-size":e.value,onPageChanged:l},null,8,["total-items","page-size"])])]))}},Vt=A(Rt,[["__scopeId","data-v-3774cbfc"]]),Et={class:"bg-black"},Ot={class:"bg-black"},Ht={__name:"TablePage",setup(f){return(d,n)=>(u(),b("section",Et,[t("div",Ot,[T(Vt,{class:""}),T(W)])]))}};export{Ht as default};
